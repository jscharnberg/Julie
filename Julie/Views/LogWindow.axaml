<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Width="1500"
        x:Class="Julie.Views.LogWindow"
        x:DataType="vm:LogViewModel"
        xmlns:vm="using:Julie.ViewModels"
        xmlns:converter="using:Julie.Converter"
        Title="{Binding FooterText}">

	<Window.Styles>
		<Style Selector="SelectableTextBlock">
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Margin" Value="0"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>
		<Style Selector="TextBlock">
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Margin" Value="0"/>
			<Setter Property="TextAlignment" Value="Center"/>
		</Style>
	</Window.Styles>


	<Window.Resources>
		<converter:LogLevelToColorConverter x:Key="LogLevelGroupToBrush"/>
		<converter:ResourceConverter x:Key="Res"/>
	</Window.Resources>

	<DockPanel >
		<!-- Header -->
		<Border DockPanel.Dock="Top" Padding="10" BorderThickness="0,0,0,1">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="200"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="500"/>
				</Grid.ColumnDefinitions>

				<!-- Projektname -->
				<StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Spacing="5">
					<Image Source="avares://Julie/Assets/Images/Logo_Orange_Transparent.png"
						   Width="20" Height="20" Stretch="Uniform"/>
					<TextBlock Text="{Binding ProjectName}"
							   FontWeight="Bold" FontSize="16"/>
				</StackPanel>


				<TextBox x:Name="SearchBox" Grid.Column="1" HorizontalAlignment="Stretch" Watermark="Search logs..."
                 Text="{Binding SearchText, Mode=TwoWay}" VerticalAlignment="Center" Margin="0, 0, 250, 0"/>

				<!-- Rechts: AutoScroll Checkbox + Settings Icon -->
				<StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Spacing="15" HorizontalAlignment="Right">
					<StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
						<TextBlock Text="Auto Update" VerticalAlignment="Center"/>
						<ToggleSwitch
							IsChecked="{Binding AutoUpdate, Mode=TwoWay}"
							IsEnabled="{Binding IsAutoUpdateEnabled}" />
					</StackPanel>

					<Button Width="24" Height="24" Padding="0" Background="Transparent" BorderBrush="Transparent" Command="{Binding OpenSettingsCommand}">
						<Image Source="avares://Julie/Assets/Images/settings.png" Stretch="Uniform"/>
					</Button>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Footer -->
		<Border DockPanel.Dock="Bottom" Padding="8" BorderThickness="0,1,0,0">
			<TextBlock Text="{Binding FooterText}" HorizontalAlignment="Center"/>
		</Border>

		<!-- Toolbar (Sidebar) -->
		<StackPanel DockPanel.Dock="Left" Width="200" Margin="0,10,0,0" Spacing="10">
			<Button Content="Load Log" Command="{Binding LoadLogsAsync}" HorizontalAlignment="Center"
					Foreground="White" Padding="8,4"/>
			<Button Content="Load Log Folder" Command="{Binding LoadLogFolderAsync}" HorizontalAlignment="Center"
					Foreground="White" Padding="8,4"/>

			<TextBlock Text="Filter Levels:" HorizontalAlignment="Left" FontWeight="Bold" Margin="10,20,0,0"/>

			<!-- LogLevel Filter -->
			<StackPanel Spacing="6" Margin="10,0,0,0">
				<CheckBox Content="INFO" IsChecked="{Binding FilterInfo}" />
				<CheckBox Content="WARN" IsChecked="{Binding FilterWarn}"/>
				<CheckBox Content="ERROR" IsChecked="{Binding FilterError}" />
				<CheckBox Content="DEBUG" IsChecked="{Binding FilterDebug}" />
			</StackPanel>
		</StackPanel>

		<!-- Logs -->
		<DockPanel>
			<!-- Column headers -->
			<Border DockPanel.Dock="Top" Padding="6" BorderThickness="0,0,0,1" >
				<Grid ColumnDefinitions="170,190,100,200,300,*">
					<TextBlock Grid.Column="0" Text="Datei(Zeile)" FontWeight="SemiBold"/>
					<TextBlock Grid.Column="1" Text="Timestamp" FontWeight="SemiBold"/>
					<TextBlock Grid.Column="2" Text="Level" FontWeight="SemiBold" HorizontalAlignment="Center"/>
					<TextBlock Grid.Column="3" Text="File" FontWeight="SemiBold"/>
					<TextBlock Grid.Column="4" Text="Method" FontWeight="SemiBold"/>
					<TextBlock Grid.Column="5" Text="Message"  FontWeight="SemiBold"/>
				</Grid>
			</Border>

			<!-- Log List -->
			<ListBox ItemsSource="{Binding FilteredLogs}"
                     x:Name="LogList"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                     ScrollViewer.VerticalScrollBarVisibility="Auto">

				<!-- Styles -->
				<ListBox.Styles>
					<Style Selector="ListBoxItem /template/ ContentPresenter">
						<Setter Property="Padding" Value="4"/>
					</Style>
					<Style Selector="ListBoxItem:selected /template/ ContentPresenter">
						<Setter Property="Background" />
					</Style>
					<Style Selector="ListBoxItem:pointerover /template/ ContentPresenter">
						<Setter Property="Background"/>
					</Style>
				</ListBox.Styles>

				<ListBox.ItemTemplate>
					<DataTemplate>
						<Grid ColumnDefinitions="170,190,100,200,300,*">
							<!-- Datei(Zeile) -->
							<SelectableTextBlock Grid.Column="0" Text="{Binding SourceFileAndLine}" Foreground="#888888"/>
							<!-- Timestamp -->
							<SelectableTextBlock Grid.Column="1" Text="{Binding Stamp}" />
							<!-- Level -->
							<SelectableTextBlock Grid.Column="2" Text="{Binding LogType}"
                                                 Foreground="{Binding LogType, Converter={StaticResource LogLevelGroupToBrush}}"/>
							<!-- File -->
							<SelectableTextBlock Grid.Column="3" Text="{Binding LogFileAndLine}" Foreground="#888888"/>
							<!-- Method -->
							<SelectableTextBlock Grid.Column="4" Text="{Binding Method}" Foreground="#888888"/>
							<!-- Message -->
							<SelectableTextBlock Grid.Column="5" Text="{Binding Text}" Foreground="#888888" TextWrapping="Wrap"/>
						</Grid>
					</DataTemplate>
				</ListBox.ItemTemplate>
			</ListBox>
		</DockPanel>
	</DockPanel>
</Window>
